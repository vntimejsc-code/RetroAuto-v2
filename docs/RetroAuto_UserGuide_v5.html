
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RetroAuto v2 - User Guide v5.0</title>
    
<style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=JetBrains+Mono:wght@400;600&display=swap');

    body {
        font-family: 'Merriweather', serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 40px;
    }
    h1, h2, h3 { font-family: sans-serif; color: #2c3e50; }
    h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; break-before: always; page-break-before: always; }
    h2 { margin-top: 30px; border-bottom: 1px solid #eee; }
    code { font-family: 'JetBrains Mono', monospace; background: #f4f4f4; padding: 2px 5px; border-radius: 3px; font-size: 0.9em; }
    pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border: 1px solid #ddd; }
    pre code { background: none; padding: 0; }
    blockquote { border-left: 4px solid #3498db; margin: 0; padding-left: 15px; color: #555; background: #f1f9ff; padding: 10px; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    img { max-width: 100%; height: auto; display: block; margin: 20px auto; }

    @media print {
        body { max-width: 100%; padding: 0; }
        a { text-decoration: none; color: #333; }
        pre, blockquote { page-break-inside: avoid; }
        h1 { page-break-before: always; }
        h1:first-child { page-break-before: avoid; }
    }
</style>

</head>
<body>
    <div style="text-align: center; padding: 50px 0; page-break-after: always;">
        <h1 style="font-size: 3em; border: none;">RetroAuto v2</h1>
        <h2 style="font-size: 2em; border: none; color: #555;">The Encyclopedia (v5.0)</h2>
        <p>Generated: 2025-12-23</p>
    </div>
    <section class='chapter'><h1>Part 1: The Launchpad (Bá»‡ phÃ³ng) ğŸš€</h1>
> *Tá»« Zero Ä‘áº¿n Hero trong 30 phÃºt*

---

<h2>1.1 Prerequisites & Environment (Tiá»n Ä‘iá»u kiá»‡n)</h2>

TrÆ°á»›c khi cÃ i Ä‘áº·t RetroAuto, hÃ£y Ä‘áº£m báº£o mÃ´i trÆ°á»ng Windows cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘Ãºng. <b>60% lá»—i "Image not found"</b> Ä‘áº¿n tá»« viá»‡c bá» qua bÆ°á»›c nÃ y.

<h3>âœ… Checklist Báº¯t buá»™c</h3>

| # | Má»¥c | CÃ¡ch kiá»ƒm tra | Táº¡i sao quan trá»ng? |
|---|-----|---------------|---------------------|
| 1 | <b>DPI Scaling = 100%</b> | Settings â†’ Display â†’ Scale = 100% | Pixel coordinates bá»‹ lá»‡ch náº¿u scale khÃ¡c 100% |
| 2 | <b>Admin Rights</b> | Chuá»™t pháº£i â†’ "Run as Administrator" | Má»™t sá»‘ game cháº·n input tá»« app khÃ´ng cÃ³ quyá»n Admin |
| 3 | <b>Borderless Windowed</b> | Trong game: Settings â†’ Display â†’ Borderless | Fullscreen cháº·n screenshot/input tá»« bÃªn ngoÃ i |
| 4 | <b>Night Light OFF</b> | Settings â†’ Display â†’ Night Light = Off | MÃ u sáº¯c bá»‹ biáº¿n Ä‘á»•i lÃ m há»ng image matching |

<h3>ğŸ–¥ï¸ Multi-Monitor Setup</h3>

Náº¿u báº¡n cÃ³ nhiá»u mÃ n hÃ¬nh:
- <b>Tá»a Ä‘á»™ (0, 0):</b> LuÃ´n á»Ÿ gÃ³c trÃªn-trÃ¡i cá»§a mÃ n hÃ¬nh CHÃNH (Primary).
- <b>MÃ n hÃ¬nh phá»¥:</b> CÃ³ thá»ƒ cÃ³ tá»a Ä‘á»™ Ã¢m (vÃ­ dá»¥: <code>-1920, 0</code> náº¿u náº±m bÃªn trÃ¡i).
- <b>Khuyáº¿n nghá»‹:</b> Cháº¡y game trÃªn mÃ n hÃ¬nh chÃ­nh Ä‘á»ƒ trÃ¡nh ráº¯c rá»‘i.

<h3>âš¡ Power Settings</h3>

Náº¿u báº¡n cháº¡y bot qua Ä‘Ãªm:
<code></code>`
Settings â†’ Power & Sleep â†’ Screen: Never | Sleep: Never
<code></code>`
Hoáº·c: Download cÃ´ng cá»¥ "Caffeine" Ä‘á»ƒ giá»¯ mÃ¡y tá»‰nh.

---

<h2>1.2 Quickstart: "The 5-Minute Bot" â±ï¸</h2>

> <b>Goal:</b> Viáº¿t bot tá»± Ä‘á»™ng search Google trong 5 phÃºt.
> <b>YÃªu cáº§u:</b> ÄÃ£ cÃ i Python 3.11+, pip.

<h3>BÆ°á»›c 1: CÃ i Ä‘áº·t (2 phÃºt)</h3>

<code></code>`powershell
<h1>Clone hoáº·c download RetroAuto</h1>
cd C:\Auto\Newauto

<h1>CÃ i dependencies</h1>
pip install -r requirements.txt
<code></code>`

<h3>BÆ°á»›c 2: Cháº¡y App (30 giÃ¢y)</h3>

<code></code>`powershell
python -m app.main
<code></code>`

Cá»­a sá»• RetroAuto sáº½ hiá»‡n ra vá»›i 3 panel: <b>Assets | Actions | Properties</b>.

<h3>BÆ°á»›c 3: Táº¡o Script Ä‘áº§u tiÃªn (2 phÃºt)</h3>

1. <b>ThÃªm Action "Click":</b>
   - Báº¥m nÃºt <code>+ Click</code> trÃªn Quick Add Bar.
   - Trong Properties: Nháº­p <code>x=500, y=300</code> (vá»‹ trÃ­ search box cá»§a Google, báº¡n tá»± Ä‘iá»u chá»‰nh).

2. <b>ThÃªm Action "TypeText":</b>
   - Báº¥m <code>+ Type</code>.
   - Trong Properties: <code>text="Hello RetroAuto"</code>, <code>enter=true</code>.

3. <b>Save & Run:</b>
   - <code>Ctrl+S</code> Ä‘á»ƒ lÆ°u.
   - <code>F5</code> Ä‘á»ƒ cháº¡y.

<h3>ğŸ‰ Káº¿t quáº£</h3>

Náº¿u báº¡n Ä‘ang má»Ÿ trÃ¬nh duyá»‡t vá»›i Google, con trá» sáº½ click vÃ o Ã´ search vÃ  gÃµ "Hello RetroAuto" + Enter.

<b>ChÃºc má»«ng! Báº¡n Ä‘Ã£ viáº¿t bot Ä‘áº§u tiÃªn.</b> ğŸŠ

---

<h2>1.3 Installation & Dependencies</h2>

<h3>YÃªu cáº§u há»‡ thá»‘ng</h3>

| Component | Version | Ghi chÃº |
|-----------|---------|---------|
| OS | Windows 10/11 | ChÆ°a há»— trá»£ Linux/macOS |
| Python | 3.11+ | Khuyáº¿n nghá»‹ 3.12 |
| RAM | 4GB+ | 8GB náº¿u dÃ¹ng OCR náº·ng |
| Tesseract | 5.x (Optional) | Cho tÃ­nh nÄƒng OCR |

<h3>CÃ i Ä‘áº·t chi tiáº¿t</h3>

<code></code>`powershell
<h1>1. Clone repo</h1>
git clone https://github.com/your-repo/retroauto.git
cd retroauto

<h1>2. Táº¡o virtual environment (khuyáº¿n nghá»‹)</h1>
python -m venv .venv
.venv\Scripts\activate

<h1>3. CÃ i dependencies</h1>
pip install -r requirements.txt

<h1>4. (Optional) CÃ i Tesseract cho OCR</h1>
<h1>Download tá»«: https://github.com/UB-Mannheim/tesseract/wiki</h1>
<h1>CÃ i vÃ o: C:\Program Files\Tesseract-OCR</h1>
<code></code>`

<h3>Cáº¥u trÃºc thÆ° má»¥c</h3>

<code></code>`
retroauto/
â”œâ”€â”€ app/            # UI code (PySide6)
â”œâ”€â”€ core/           # Engine, DSL parser, Runner
â”œâ”€â”€ infra/          # Logging, Crash handler
â”œâ”€â”€ assets/         # Image templates (báº¡n lÆ°u á»Ÿ Ä‘Ã¢y)
â”œâ”€â”€ scripts/        # Saved scripts (.retro files)
â””â”€â”€ docs/           # TÃ i liá»‡u nÃ y
<code></code>`

---

<h2>1.4 Interface Tour (KhÃ¡m phÃ¡ giao diá»‡n)</h2>

<h3>Main Window (Cá»­a sá»• chÃ­nh)</h3>

<code></code>`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Toolbar: Run | Pause | Stop | Capture | IDE | Save]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Assets  â”‚       Actions           â”‚    Properties      â”‚
â”‚  Panel   â”‚       Panel             â”‚    Panel           â”‚
â”‚          â”‚                         â”‚                    â”‚
â”‚ ğŸ“· img1  â”‚ 1. Click(100, 200)      â”‚ Action: Click      â”‚
â”‚ ğŸ“· img2  â”‚ 2. WaitImage("img1")    â”‚ x: [100]           â”‚
â”‚          â”‚ 3. TypeText("Hello")    â”‚ y: [200]           â”‚
â”‚          â”‚                         â”‚ button: [left â–¼]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<code></code>`

- <b>Assets Panel (TrÃ¡i):</b> Quáº£n lÃ½ hÃ¬nh áº£nh máº«u.
- <b>Actions Panel (Giá»¯a):</b> Danh sÃ¡ch hÃ nh Ä‘á»™ng (Flow).
- <b>Properties Panel (Pháº£i):</b> Chá»‰nh sá»­a tham sá»‘ action Ä‘ang chá»n.

<h3>IDE Window (Cá»­a sá»• Code)</h3>

Báº¥m nÃºt <b>IDE</b> trÃªn toolbar Ä‘á»ƒ má»Ÿ cháº¿ Ä‘á»™ viáº¿t code:

<code></code>`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Toolbar: Run | Save | Format]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Structureâ”‚         Code Editor                 â”‚Minimap â”‚
â”‚ Panel    â”‚                                     â”‚        â”‚
â”‚          â”‚ @main:                              â”‚ â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚ â–¶ @main  â”‚     click(100, 200)                 â”‚ â–‘â–‘â–‘    â”‚
â”‚ â–¶ @heal  â”‚     wait_image("btn_ok")            â”‚ â–‘â–‘â–‘â–‘   â”‚
â”‚          â”‚     run_flow("heal")                â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<code></code>`

- <b>Structure Panel (TrÃ¡i):</b> Outline cá»§a flows vÃ  labels.
- <b>Code Editor (Giá»¯a):</b> Viáº¿t DSL vá»›i Intellisense.
- <b>Minimap (Pháº£i):</b> NhÃ¬n tá»•ng quan code, click Ä‘á»ƒ nháº£y.

---

> ğŸ‘‰ <b>Tiáº¿p theo:</b> [Part 3: The Cookbook](./cookbook.md) - Há»c qua cÃ¡c bÃ i thá»±c hÃ nh thá»±c táº¿.
</section>
<section class='chapter'><h1>Part 2: Visual IDE Manual (Giao Diá»‡n Äá»“ Há»a)</h1>
> *DÃ nh cho Operator & Non-Coder: KÃ©o tháº£ Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a.*

---

<h2>2.1 The Workbench (BÃ n LÃ m Viá»‡c)</h2>

Giao diá»‡n RetroAuto chia lÃ m 3 cá»™t chÃ­nh:

<h3>1. Assets Panel (Kho TÃ i NguyÃªn) - Cá»™t TrÃ¡i</h3>
Quáº£n lÃ½ "Ä‘Ã´i máº¯t" cá»§a bot.
*   <b>Import:</b> KÃ©o file áº£nh <code>.png</code> vÃ o Ä‘Ã¢y.
*   <b>Capture Tool (F2):</b> Cáº¯t áº£nh trá»±c tiáº¿p tá»« game.
*   <b>Chuá»™t pháº£i:</b> Rename, Delete, Copy Path.

<h3>2. Actions Panel (Ká»‹ch Báº£n) - Cá»™t Giá»¯a</h3>
Danh sÃ¡ch lá»‡nh thá»±c thi tuáº§n tá»±.
*   <b>KÃ©o tháº£:</b> Thay Ä‘á»•i thá»© tá»± lá»‡nh.
*   <b>Disable:</b> Táº¯t táº¡m thá»i má»™t lá»‡nh (Chuá»™t pháº£i -> Disable).
*   <b>Group:</b> (Sáº¯p ra máº¯t) Gom nhÃ³m lá»‡nh.

<h3>3. Properties Panel (Chi Tiáº¿t) - Cá»™t Pháº£i</h3>
Chá»‰nh sá»­a tham sá»‘ tá»«ng lá»‡nh.
*   <b>Click Action:</b> Tá»a Ä‘á»™ <code>x, y</code>, nÃºt <code>left/right</code>.
*   <b>Wait Action:</b> <code>Asset ID</code>, <code>Timeout</code> (ms).
*   <b>Logic:</b> <code>Condition</code>, <code>Jump Label</code>.

---

<h2>2.2 Common Workflows</h2>

<h3>Táº¡o Script má»›i</h3>
1. Má»Ÿ App -> File -> New Script.
2. Báº¥m <code>F2</code> Ä‘á»ƒ cáº¯t áº£nh cÃ¡c nÃºt trong game (Button Start, Button Login).
3. Äáº·t tÃªn gá»£i nhá»› cho áº£nh (vd: <code>btn_start</code>, <code>btn_login</code>).
4. KÃ©o lá»‡nh <code>ClickImage</code> tá»« toolbar vÃ o Actions Panel.
5. Chá»n <code>btn_start</code> trong Properties.
6. Báº¥m <code>F5</code> cháº¡y thá»­.

<h3>Chá»‰nh sá»­a tá»a Ä‘á»™</h3>
Náº¿u khÃ´ng muá»‘n tÃ¬m áº£nh, báº¡n cÃ³ thá»ƒ click theo tá»a Ä‘á»™ cá»©ng (khÃ´ng khuyáº¿n khÃ­ch).
1. DÃ¹ng Action <code>Click</code>.
2. Báº¥m nÃºt "Pick" (hÃ¬nh á»‘ng hÃºt) trong Properties.
3. Click vÃ o Ä‘iá»ƒm trÃªn mÃ n hÃ¬nh Ä‘á»ƒ láº¥y tá»a Ä‘á»™ <code>x, y</code>.
</section>
<section class='chapter'><h1>Part 3: Code & Debugging Manual (Láº­p TrÃ¬nh & Gá»¡ Lá»—i)</h1>
> *DÃ nh cho Developer: Viáº¿t code nhanh, sá»­a lá»—i siÃªu tá»‘c.*

---

<h2>3.1 The Code Editor (TrÃ¬nh Soáº¡n Tháº£o)</h2>

<h3>Intellisense (Gá»£i Ã½ thÃ´ng minh)</h3>
- <b>KÃ­ch hoáº¡t:</b> <code>Ctrl + Space</code>
- <b>Chá»©c nÄƒng:</b>
  - Gá»£i Ã½ lá»‡nh: GÃµ <code>cl</code> => <code>click</code>, <code>click_image</code>.
  - Gá»£i Ã½ Asset: GÃµ <code>"</code> => Danh sÃ¡ch ID tá»« Assets Panel.
  - Signature Help: GÃµ <code>(</code> => Hiá»‡n tham sá»‘ <code>(x, y, button, ...)</code>

<h3>Minimap (Báº£n Ä‘á»“ Code)</h3>
Dáº£i bÃªn pháº£i hiá»ƒn thá»‹ tá»•ng quan logic.
- <b>MÃ u Xanh:</b> Flow definitions (<code>@main</code>).
- <b>MÃ u TÃ­m:</b> Logic loops (<code>loop</code>, <code>if</code>).
- <b>Thao tÃ¡c:</b> Click Ä‘á»ƒ cuá»™n nhanh.

---

<h2>3.2 The Debugger (TrÃ¬nh Gá»¡ Lá»—i) ğŸ</h2>
*TÃ­nh nÄƒng cao cáº¥p giÃºp báº¡n "soi" tá»«ng dÃ²ng code.*

<h3>Giao diá»‡n Debug Panel</h3>
Náº±m á»Ÿ dÆ°á»›i cÃ¹ng (hoáº·c tab bÃªn pháº£i):

| Tab | Chá»©c nÄƒng |
|-----|-----------|
| <b>Call Stack</b> | Xem bot Ä‘ang cháº¡y á»Ÿ Flow nÃ o, dÃ²ng nÃ o. |
| <b>Variables</b> | Xem giÃ¡ trá»‹ biáº¿n (<code>$hp</code>, <code>$count</code>) theo thá»i gian thá»±c. |
| <b>Breakpoints</b> | Quáº£n lÃ½ cÃ¡c Ä‘iá»ƒm dá»«ng. |

<h3>CÃ¡c Lá»‡nh Äiá»u Khiá»ƒn (Debug Controls)</h3>

| Icon | Lá»‡nh | PhÃ­m táº¯t | MÃ´ táº£ |
| :---: | :--- | :--- | :--- |
| â–¶ | <b>Continue</b> | F5 | Cháº¡y tiáº¿p cho Ä‘áº¿n breakpoint tiáº¿p theo. |
| â¸ | <b>Pause</b> | F6 | Táº¡m dá»«ng bot ngay láº­p tá»©c. |
| â¤µ | <b>Step Over</b> | F10 | Cháº¡y 1 dÃ²ng lá»‡nh tiáº¿p theo (KhÃ´ng chui vÃ o Flow con). |
| â†´ | <b>Step Into</b> | F11 | Chui vÃ o bÃªn trong Flow/HÃ m Ä‘ang gá»i. |
| â†± | <b>Step Out</b> | Shift+F11 | Cháº¡y cho Ä‘áº¿n khi thoÃ¡t khá»i Flow hiá»‡n táº¡i. |
| â–  | <b>Stop</b> | F8 | Dá»«ng háº³n chÆ°Æ¡ng trÃ¬nh. |

<h3>CÃ¡ch Debug Hiá»‡u Quáº£</h3>

#### 1. Äáº·t Breakpoint (Äiá»ƒm dá»«ng)
- <b>CÃ¡ch lÃ m:</b> Click vÃ o lá» trÃ¡i (sá»‘ dÃ²ng) trong Code Editor -> Xuáº¥t hiá»‡n cháº¥m Ä‘á» ğŸ”´.
- <b>TÃ¡c dá»¥ng:</b> Khi cháº¡y Ä‘áº¿n dÃ²ng nÃ y, bot sáº½ tá»± Ä‘á»™ng Pause.

#### 2. Soi Biáº¿n (Variables Watch)
- Khi bot Ä‘ang Pause, chuyá»ƒn sang tab <b>Variables</b>.
- Báº¡n sáº½ tháº¥y giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a má»i biáº¿n.
- <b>Watch:</b> Nháº­p tÃªn biáº¿n (vd: <code>$hp</code>) vÃ o Ã´ Watch Ä‘á»ƒ theo dÃµi riÃªng nÃ³.

#### 3. Stack Trace
- Khi bot Pause trong má»™t Flow con, <b>Call Stack</b> cho biáº¿t ai Ä‘Ã£ gá»i nÃ³.
- <b>VÃ­ dá»¥:</b> <code>Main > Loop > AttackFlow > UseSkill</code>.

---

<h2>3.3 Output & Diagnostics (Nháº­t kÃ½ & Cháº©n Ä‘oÃ¡n)</h2>

<h3>Output Log</h3>
Hiá»ƒn thá»‹ lá»‹ch sá»­ cháº¡y cá»§a bot.
- <b>MÃ u sáº¯c:</b>
  - âš« Info: Sá»± kiá»‡n thÆ°á»ng.
  - ğŸŸ¡ Warning: TÃ¬m áº£nh Ä‘á»™ khá»›p tháº¥p.
  - ğŸ”´ Error: Lá»—i logic.

<h3>Problems Tab</h3>
Danh sÃ¡ch lá»—i cÃº phÃ¡p (Syntax Errors) vÃ  cáº£nh bÃ¡o (Warnings).
- Click Ä‘Ãºp vÃ o lá»—i Ä‘á»ƒ nháº£y Ä‘áº¿n dÃ²ng code bá»‹ sai.
</section>
<section class='chapter'><h1>Part 4: Core Concepts (NguyÃªn LÃ½ Cá»‘t LÃµi) ğŸ§ </h1>

---

<h2>4.1 Execution Model (CÆ¡ cháº¿ Hoáº¡t Ä‘á»™ng)</h2>

RetroAuto sá»­ dá»¥ng <b>Event Loop Hybrid</b>: Káº¿t há»£p giá»¯a tuáº§n tá»± (Main Thread) vÃ  song song (Interrupt Watchdog).

<h3>ğŸ“ The Runtime Loop ASCII Art</h3>

<code></code>`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN THREAD (Synchronous) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   [Start]                                                   â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Fetch Instruction] <â”€â”€â”€(Step Pointer)                    â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Execute Action] (Click, Type, Wait...)                   â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚  âš ï¸ BLOCKED? (e.g. sleep 5s)                         â”‚
â”‚      â”‚  (Main thread sleeps, but Background thread is ALIVE)â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Check Events] (Stop? Pause?)                             â”‚
â”‚      â”‚                                                      â”‚
â”‚      â””â”€â”€â”€â–º Loop to Next Instruction                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–²                 â”‚
               â”‚ (Pause Request) â”‚ (Resume)
               â”‚                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACKGROUND THREAD (Asynchronous) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   [Sentinel Timer (500ms)]                                  â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Scan All Interrupt Rules]                                â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€â–º Rule 1: Login Screen? (No)                        â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€â–º Rule 2: Low HP? (YES!) â”€â”€â”                        â”‚
â”‚      â”‚                             â”‚                        â”‚
â”‚      â””â”€â”€â–º Rule 3: Error Popup?     â”‚                        â”‚
â”‚                                    â”‚                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚          â–¼                                                  â”‚
â”‚   [PREEMPTION TRIGGERED]                                    â”‚
â”‚   1. Pause Main Thread                                      â”‚
â”‚   2. Save Context (Stack/Variables)                         â”‚
â”‚   3. Run "HealFlow"                                         â”‚
â”‚   4. Resume Main Thread                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<code></code>`

---

<h2>4.2 Priority System (Há»‡ thá»‘ng Æ¯u tiÃªn)</h2>

Khi nhiá»u sá»± kiá»‡n xáº£y ra cÃ¹ng lÃºc, ai tháº¯ng?

<code></code>`
High Priority (P10) > Medium (P5) > Low (P1)
<code></code>`

<b>VÃ­ dá»¥ xung Ä‘á»™t:</b>
- <b>Sá»± kiá»‡n A:</b> Háº¿t mÃ¡u (P10, Flow: "Heal")
- <b>Sá»± kiá»‡n B:</b> TÃºi Ä‘áº§y (P5, Flow: "SellItems")

<b>Ká»‹ch báº£n:</b>
1. Bot tháº¥y cáº£ "Háº¿t mÃ¡u" vÃ  "TÃºi Ä‘áº§y".
2. <b>P10 (Heal)</b> chiáº¿n tháº¯ng -> Cháº¡y <code>Heal</code> trÆ°á»›c.
3. Sau khi <code>Heal</code> xong, náº¿u váº«n tháº¥y "TÃºi Ä‘áº§y", cháº¡y <code>SellItems</code>.

---

<h2>4.3 Coordinate Systems (Há»‡ Tá»a Äá»™)</h2>

CÃ¡ch RetroAuto Ä‘á»‹nh vá»‹ trÃªn mÃ n hÃ¬nh:

<code></code>`
(0,0) Top-Left
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€X (Width)
  â”‚
  â”‚      [Global Coordinate]
  â”‚      Click(500, 300)
  â”‚          Target
  â”‚            â–¼
  â”‚            âœ•
  â”‚
  â”‚
  Y
(Height)
<code></code>`

<b>ROI (Region of Interest - VÃ¹ng quan tÃ¢m):</b>
Thay vÃ¬ tÃ¬m trÃªn cáº£ mÃ n hÃ¬nh, chá»‰ tÃ¬m trong má»™t há»™p nhá».

<code></code>`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Screen (1920x1080)                               â”‚
â”‚                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ ROI (Health Bar) â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ [##########........] 50%        â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<code></code>`
<b>Lá»£i Ã­ch:</b> TÄƒng tá»‘c Ä‘á»™ tÃ¬m kiáº¿m gáº¥p 5-10 láº§n.
</section>
<section class='chapter'><h1>Part 3: The Cookbook (MÃ³n Ngon Thá»±c Chiáº¿n) ğŸ³</h1>
> *Há»c qua hÃ nh Ä‘á»™ng. Copy, Paste, vÃ  Cháº¡y.*

ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i "CÄƒn báº¿p Automation". Táº¡i Ä‘Ã¢y, chÃºng ta sáº½ khÃ´ng nÃ³i lÃ½ thuyáº¿t suÃ´ng. Báº¡n sáº½ há»c cÃ¡ch náº¥u nhá»¯ng "mÃ³n Äƒn" (script) phá»• biáº¿n nháº¥t mÃ  báº¥t ká»³ pro-gamer hay operator nÃ o cÅ©ng cáº§n.

---

<h2>ğŸ¥— Recipe 1: The Login Guard (Há»™ Vá»‡ ÄÄƒng Nháº­p)</h2>
<b>Level:</b> ğŸŸ¢ Dá»… | <b>Time:</b> 5 phÃºt | <b>Concept:</b> Interrupts (Sá»± kiá»‡n)

<h3>Váº¥n Ä‘á»</h3>
Game online hay bá»‹ disconnect (máº¥t máº¡ng) hoáº·c vÄƒng game khi treo mÃ¡y Ä‘Ãªm. Báº¡n muá»‘n bot tá»± Ä‘á»™ng Ä‘Äƒng nháº­p láº¡i khi tháº¥y mÃ n hÃ¬nh login.

<h3>NguyÃªn liá»‡u</h3>
1.  áº¢nh <code>screen_login.png</code>: MÃ n hÃ¬nh Ä‘Äƒng nháº­p.
2.  áº¢nh <code>btn_start.png</code>: NÃºt "VÃ o game".
3.  Flow "LoginFlow": Chuá»—i hÃ nh Ä‘á»™ng Ä‘á»ƒ Ä‘Äƒng nháº­p.

<h3>CÃ¡ch cháº¿ biáº¿n (Step-by-Step)</h3>

#### BÆ°á»›c 1: Táº¡o Flow ÄÄƒng Nháº­p (<code>LoginFlow</code>)
VÃ o <code>Flow Editor</code>, táº¡o má»™t flow má»›i tÃªn <code>LoginFlow</code>:

<code></code>`retroscript
@LoginFlow:
    # 1. Chá» nÃºt Start xuáº¥t hiá»‡n (phÃ²ng khi mÃ¡y cháº­m)
    wait_image("btn_start", timeout=10s)

    # 2. Click vÃ o nÃºt Start
    click_image("btn_start")

    # 3. Chá» loading xong (Loading screen biáº¿n máº¥t)
    wait_image("screen_loading", appear=false, timeout=60s)

    # 4. ThÃ´ng bÃ¡o Ä‘Ã£ vÃ o láº¡i game
    notify("Reconnected successfully!", method=popup)
<code></code>`

#### BÆ°á»›c 2: CÃ i Äáº·t "Há»™ Vá»‡" (Interrupt Rule)
ChÃºng ta khÃ´ng muá»‘n viáº¿t lá»‡nh <code>check_login</code> vÃ o má»i nÆ¡i trong script chÃ­nh (Farming). HÃ£y dÃ¹ng tÃ­nh nÄƒng <b>Interrupts</b> (TÆ°Æ¡ng tá»± nhÆ° pháº£n xáº¡ khÃ´ng Ä‘iá»u kiá»‡n).

1.  Chuyá»ƒn sang tab <b>âš¡ Interrupts</b>.
2.  Báº¥m <code>Add Rule</code>.
3.  <b>Trigger Image:</b> Chá»n <code>screen_login.png</code>.
4.  <b>Action:</b> Run Flow -> <code>LoginFlow</code>.
5.  <b>Priority:</b> <code>High (P10)</code> (Æ¯u tiÃªn cao nháº¥t, dá»«ng má»i viá»‡c khÃ¡c Ä‘á»ƒ login).
6.  <b>Cooldown:</b> <code>30s</code> (Äá»ƒ trÃ¡nh spam login liÃªn tá»¥c).

<h3>ğŸ¯ Káº¿t quáº£</h3>
BÃ¢y giá», dÃ¹ báº¡n Ä‘ang farm quÃ¡i á»Ÿ Flow nÃ o, chá»‰ cáº§n mÃ n hÃ¬nh Login hiá»‡n ra, RetroAuto sáº½ <b>ngay láº­p tá»©c</b> táº¡m dá»«ng viá»‡c farm, cháº¡y <code>LoginFlow</code> Ä‘á»ƒ vÃ o láº¡i game, rá»“i tiáº¿p tá»¥c farm.

---

<h2>ğŸ² Recipe 2: The Infinite Farming Loop (VÃ²ng Láº·p VÃ´ Táº­n)</h2>
<b>Level:</b> ğŸŸ¡ Trung BÃ¬nh | <b>Time:</b> 10 phÃºt | <b>Concept:</b> Logic & State

<h3>Váº¥n Ä‘á»</h3>
Báº¡n muá»‘n nhÃ¢n váº­t tá»± tÃ¬m quÃ¡i, Ä‘Ã¡nh quÃ¡i, nháº·t Ä‘á»“. Khi mÃ¡u tháº¥p (< 50%) thÃ¬ tá»± bÆ¡m mÃ¡u. Khi tÃºi Ä‘áº§y thÃ¬ tá»± vá» thÃ nh bÃ¡n Ä‘á»“.

<h3>NguyÃªn liá»‡u</h3>
-   <code>monster.png</code>: QuÃ¡i váº­t.
-   <code>hp_low.png</code>: Thanh mÃ¡u khi cáº¡n (mÃ u Ä‘á» nháº¡t).
-   <code>inventory_full.png</code>: ThÃ´ng bÃ¡o tÃºi Ä‘áº§y.

<h3>CÃ¡ch cháº¿ biáº¿n</h3>

HÃ£y viáº¿t script dáº¡ng DSL (IDE Mode) Ä‘á»ƒ dá»… quáº£n lÃ½ logic phá»©c táº¡p.

<code></code>`retroscript
@main:
    # VÃ²ng láº·p chÃ­nh vÃ´ táº­n
    loop 999999:

        # 1. Kiá»ƒm tra an toÃ n trÆ°á»›c
        run_flow("SafetyCheck")

        # 2. TÃ¬m quÃ¡i
        if_image("monster"):
            # TÃ¬m tháº¥y quÃ¡i -> ÄÃ¡nh
            click_image("monster")

            # Äá»£i Ä‘Ã¡nh xong (VÃ­ dá»¥: chá» thanh exp hiá»‡n lÃªn hoáº·c quÃ¡i biáº¿n máº¥t)
            wait_image("monster", appear=false, timeout=10s)

            # Nháº·t Ä‘á»“ (Loop nháº·t 3 láº§n cho cháº¯c)
            loop 3:
                hotkey("Space") # PhÃ­m nháº·t Ä‘á»“
                sleep(200ms)
        else:
            # KhÃ´ng tháº¥y quÃ¡i -> TÃ¬m gÃ³c khÃ¡c hoáº·c xoay camera
            hotkey("Tab")
            sleep(1s)

        # 3. Giáº£ láº­p nghá»‰ ngÆ¡i (Anti-ban)
        delay_random(500, 1500)

@SafetyCheck:
    # 1. BÆ¡m mÃ¡u (Logic sinh tá»“n)
    if_image("hp_low"):
        hotkey("F1") # PhÃ­m bÃ¬nh mÃ¡u
        sleep(500ms)

    # 2. Check tÃºi Ä‘áº§y (Logic tÃ i nguyÃªn)
    if_image("inventory_full"):
        notify("Inventory full! Going home...", method=telegram)
        run_flow("GoHomeAndSell") # Flow vá» thÃ nh (báº¡n tá»± define nhÃ©)
<code></code>`

<h3>ğŸ’¡ BÃ­ kÃ­p cá»§a Äáº§u báº¿p (Chef's Tips)</h3>

1.  <b>Äá»«ng check <code>hp_low</code> liÃªn tá»¥c trong main loop:</b> HÃ£y tÃ¡ch ra thÃ nh <code>@SafetyCheck</code> Ä‘á»ƒ code gá»n gÃ ng.
2.  <b>Anti-Ban:</b> LuÃ´n dÃ¹ng <code>delay_random</code> thay vÃ¬ <code>sleep</code> cá»‘ Ä‘á»‹nh. Game master ráº¥t ghÃ©t nhá»¯ng ai báº¥m nÃºt Ä‘á»u nhÆ° váº¯t chanh (vd: Ä‘Ãºng 1000ms má»—i láº§n).
3.  <b>Fail-safe:</b> LuÃ´n cÃ³ <code>timeout</code> cho <code>wait_image</code>. Äá»«ng Ä‘á»ƒ bot chá» mÃ£i mÃ£i má»™t hÃ¬nh áº£nh cÃ³ thá»ƒ khÃ´ng bao giá» hiá»‡n (vÃ­ dá»¥: lag game lÃ m máº¥t hÃ¬nh quÃ¡i).

---

> ğŸ‘‰ <b>BÃ i táº­p vá» nhÃ :</b> HÃ£y thá»­ káº¿t há»£p Recipe 1 vÃ  Recipe 2. Cháº¡y Farming Loop vÃ  rÃºt dÃ¢y máº¡ng ra Ä‘á»ƒ test xem Login Guard cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng nhÃ©!
</section>
<section class='chapter'><h1>Part 6: Troubleshooting & Diagnostics (Xá»­ LÃ½ Sá»± Cá»‘) ğŸ”§</h1>

---

<h2>6.1 Diagnostic Playbook (Quy trÃ¬nh Cháº©n bá»‡nh)</h2>

<h3>ğŸŒ¡ï¸ Symptom: "Image Not Found" (KhÃ´ng tÃ¬m tháº¥y áº£nh)</h3>

<b>MÃ´ táº£:</b> Bot Ä‘á»©ng yÃªn, log bÃ¡o <code>WARNING: WaitImage('xyz') timed out</code>.

<b>Decision Flow (CÃ¢y quyáº¿t Ä‘á»‹nh):</b>
<code></code>`
[START]
   â”‚
   â–¼
[Check Screen] -> Is the image visible to YOUR eyes?
   â”‚
   â”œâ”€ NO â”€â”€> [Game Logic Issue]
   â”‚          Wait longer (increase timeout)
   â”‚          or excessive lag?
   â”‚
   â””â”€ YES (I see it!)
        â”‚
        â–¼
   [Check Threshold]
        â”‚
        â”œâ”€ > 0.9? â”€â”€> Too strict. Lower to 0.7.
        â”‚
        â””â”€ < 0.7? â”€â”€> [Check Rendering]
             â”‚
             â”œâ”€ Different Resolution/DPI? (Check Settings)
             â”‚
             â”œâ”€ Color changed? (Night mode? Hover effect?)
             â”‚    â””â”€ Capture NEW image.
             â”‚
             â””â”€ Obstructed? (Mouse cursor/Tooltip covering it?)
<code></code>`

---

<h3>ğŸŒ¡ï¸ Symptom: "Bot click trÆ°á»£t" (Click Accuracy)</h3>

<b>MÃ´ táº£:</b> Bot click vÃ o chá»— khÃ´ng cÃ³ gÃ¬, hoáº·c click lá»‡ch nÃºt.

<b>NguyÃªn nhÃ¢n & Fix:</b>
1.  <b>DPI Scaling:</b> Windows Scale != 100%.
    *   *Fix:* Set Display Scale vá» 100%.
2.  <b>Offset:</b> áº¢nh máº«u cÃ³ viá»n trong suá»‘t (Transparent) quÃ¡ lá»›n.
    *   *Fix:* Cáº¯t áº£nh (Crop) sÃ¡t vÃ o ná»™i dung nÃºt, bá» viá»n.
3.  <b>Dynamic UI:</b> NÃºt di chuyá»ƒn Ä‘á»™ng.
    *   *Fix:* DÃ¹ng <code>wait_image</code> liÃªn tá»¥c Ä‘á»ƒ cáº­p nháº­t vá»‹ trÃ­ má»›i nháº¥t ngay trÆ°á»›c khi click.

---

<h2>6.2 Log Analysis (PhÃ¢n tÃ­ch Log)</h2>

Má»Ÿ tab <b>Output</b> hoáº·c file <code>logs/retroauto.log</code>.

<h3>Cáº¥u trÃºc Log</h3>
<code></code>`
[TIME]     [LEVEL]  [MODULE]    [MESSAGE]
14:05:01   INFO     Runner      Starting flow 'Farm'
14:05:02   DEBUG    Matcher     Found 'mob_slime' at (500, 200) | score=0.95
14:05:03   INFO     Input       Clicking at (505, 202)
<code></code>`

<h3>CÃ¡c tÃ­n hiá»‡u láº¡</h3>
- <b>Spam "Found...":</b> Interrupt Rule cá»§a báº¡n khÃ´ng cÃ³ cooldown hoáº·c action quÃ¡ nhanh.
- <b>"FPS drop":</b> QuÃ¡ trÃ¬nh tÃ¬m áº£nh (Vision) tá»‘n > 200ms. HÃ£y thu nhá» ROI láº¡i.

---

<h2>6.3 Reporting Bugs (BÃ¡o Lá»—i)</h2>

Khi cáº§n há»— trá»£, hÃ£y cung cáº¥p Ä‘á»§ <b>3 mÃ³n Äƒn chÆ¡i</b>:
1.  <b>Screenshot:</b> Chá»¥p mÃ n hÃ¬nh lÃºc lá»—i (cáº£ game + cá»­a sá»• RetroAuto).
2.  <b>Log File:</b> Copy 50 dÃ²ng cuá»‘i cÃ¹ng.
3.  <b>Repro Steps:</b> "Cháº¡y Flow A, Ä‘áº¿n bÆ°á»›c B thÃ¬ bá»‹ Ä‘Æ¡".

---

<h2>6.4 Advanced Debugging (Gá»¡ Lá»—i NÃ¢ng Cao)</h2>

<h3>ğŸ§  Lá»—i Logic (Bot cháº¡y nhÆ°ng khÃ´ng lÃ m gÃ¬)</h3>

<b>Symptom:</b> Script khÃ´ng bÃ¡o lá»—i, cháº¡y qua cÃ¡c bÆ°á»›c nhÆ°ng káº¿t quáº£ sai (vd: khÃ´ng click Ä‘Æ°á»£c nÃºt).

<b>Decision Tree:</b>
<code></code>`
[Bot cháº¡y nhÆ°ng khÃ´ng click Ä‘Ãºng]
   â”‚
   â”œâ”€ [1] if_image luÃ´n tráº£ vá» FALSE?
   â”‚      â””â”€ Kiá»ƒm tra Threshold / DPI / ROI.
   â”‚
   â”œâ”€ [2] if_image TRUE nhÆ°ng click khÃ´ng trÃºng?
   â”‚      â””â”€ áº¢nh máº«u cÃ³ viá»n trong suá»‘t (offset sai).
   â”‚
   â””â”€ [3] Interrupt cháº¡y liÃªn tá»¥c chiáº¿m quyá»n?
          â””â”€ Xem log cÃ³ "Interrupt triggered" spam khÃ´ng? TÄƒng Cooldown.
<code></code>`

<h3>ğŸ”§ Lá»—i MÃ´i TrÆ°á»ng</h3>

| Triá»‡u chá»©ng | NguyÃªn nhÃ¢n | Giáº£i phÃ¡p |
|-------------|-------------|-----------|
| Bot khÃ´ng Ä‘iá»u khiá»ƒn Ä‘Æ°á»£c game | Antivirus/Game Guard cháº·n input | ThÃªm RetroAuto vÃ o Whitelist / Táº¯t GameGuard. |
| Screenshot tráº£ vá» mÃ n hÃ¬nh Ä‘en | Game cháº¡y á»Ÿ DirectX Fullscreen | Äá»•i game vá» <b>Borderless Windowed</b>. |
| Tá»a Ä‘á»™ click bá»‹ lá»‡ch | Windows DPI Scaling â‰  100% | Set Display Scale vá» 100%. |
| OCR Ä‘á»c sai chá»¯ | Font game quÃ¡ nhá»/nghá»‡ thuáº­t | TÄƒng vÃ¹ng ROI, dÃ¹ng <code>psm=6</code> (block text). |

<h3>ğŸ”¥ Race Condition (Xung Ä‘á»™t Interrupt)</h3>

<b>Symptom:</b> Hai Interrupt P10 cÃ¹ng kÃ­ch hoáº¡t, bot hÃ nh xá»­ láº¡.

<b>Giáº£i phÃ¡p:</b>
1.  <b>KhÃ´ng nÃªn Ä‘áº·t 2 rule cÃ¹ng Priority cao.</b> PhÃ¢n biá»‡t rÃµ (Login=P10, Error=P8).
2.  <b>Äáº£m báº£o má»—i Interrupt Flow káº¿t thÃºc rÃµ rÃ ng</b> (khÃ´ng Ä‘á»ƒ vÃ²ng láº·p vÃ´ táº­n bÃªn trong).

</section>
<section class='chapter'><h1>Part 7: Reference Manual (Tá»« Äiá»ƒn Lá»‡nh) ğŸ“š</h1>
> *Tra cá»©u má»i chá»©c nÄƒng. KhÃ´ng bá» sÃ³t báº¥t ká»³ lá»‡nh nÃ o.*

TÃ i liá»‡u nÃ y liá»‡t kÃª Ä‘áº§y Ä‘á»§ 100% cÃ¡c lá»‡nh Ä‘Æ°á»£c há»— trá»£ trong RetroAuto v2, tÆ°Æ¡ng á»©ng vá»›i mÃ£ nguá»“n <code>tokens.py</code> vÃ  <code>actions_panel.py</code>.

---

<h2>7.1 ğŸ¯ Clicks & Mouse (Thao tÃ¡c Chuá»™t)</h2>

<h3><code>click(x, y, button="left", double=False)</code></h3>
Click vÃ o má»™t tá»a Ä‘á»™ mÃ n hÃ¬nh cá»‘ Ä‘á»‹nh.
- <b>x, y:</b> Tá»a Ä‘á»™ pixel (sá»‘ nguyÃªn).
- <b>button:</b> <code>"left"</code>, <code>"right"</code>, <code>"middle"</code>.
- <b>double:</b> <code>True</code> Ä‘á»ƒ double-click.

<h3><code>click_image(asset_id, button="left", timeout=0, double=False)</code></h3>
TÃ¬m áº£nh vÃ  click vÃ o tÃ¢m áº£nh Ä‘Ã³.
- <b>asset_id:</b> ID cá»§a tÃ i nguyÃªn (vÃ­ dá»¥: <code>"btn_ok"</code>).
- <b>timeout:</b> Thá»i gian chá» áº£nh xuáº¥t hiá»‡n (giÃ¢y). 0 = khÃ´ng chá».
- <b>Ex:</b> <code>click_image("btn_start", timeout=5s)</code>

<h3><code>click_random(x1, y1, x2, y2)</code></h3>
Click ngáº«u nhiÃªn trong vÃ¹ng hÃ¬nh chá»¯ nháº­t (Chá»‘ng ban).
- <b>x1, y1:</b> GÃ³c trÃªn-trÃ¡i.
- <b>x2, y2:</b> GÃ³c dÆ°á»›i-pháº£i.
- <b>Ex:</b> <code>click_random(100, 100, 200, 200)</code>

<h3><code>click_until(target_id, stop_id, max_clicks=10)</code></h3>
Click liÃªn tá»¥c vÃ o <code>target_id</code> cho Ä‘áº¿n khi <code>stop_id</code> xuáº¥t hiá»‡n.
- <b>Ex:</b> <code>click_until("btn_next", "screen_page2")</code> (Click Next cho Ä‘áº¿n khi sang trang 2).

<h3><code>drag(x1, y1, x2, y2, duration=500)</code></h3>
KÃ©o chuá»™t tá»« A Ä‘áº¿n B (Swipe/Drop).
- <b>duration:</b> Thá»i gian kÃ©o (ms).

<h3><code>scroll(dx, dy)</code></h3>
Cuá»™n chuá»™t.
- <b>dx:</b> Cuá»™n ngang (thÆ°á»ng lÃ  0).
- <b>dy:</b> Cuá»™n dá»c. DÆ°Æ¡ng = LÃªn, Ã‚m = Xuá»‘ng.
- <b>Ex:</b> <code>scroll(0, -500)</code> (Cuá»™n xuá»‘ng dÆ°á»›i).

---

<h2>7.2 ğŸ‘ï¸ Vision & Wait (Thá»‹ giÃ¡c)</h2>

<h3><code>wait_image(asset_id, timeout=infinite, appear=True)</code></h3>
Dá»«ng script cho Ä‘áº¿n khi áº£nh xuáº¥t hiá»‡n (hoáº·c biáº¿n máº¥t).
- <b>appear:</b> <code>True</code> (chá» hiá»‡n), <code>False</code> (chá» máº¥t).
- <b>Ex:</b> <code>wait_image("loading_spinner", appear=False)</code> (Chá» loading xong).

<h3><code>wait_pixel(x, y, color, tolerance=10)</code></h3>
Chá» má»™t Ä‘iá»ƒm pixel cÃ³ mÃ u cá»¥ thá»ƒ.
- <b>color:</b> MÃ£ mÃ u Hex (<code>#FF0000</code>) hoáº·c RGB tuple.

<h3><code>if_image(asset_id, region=None)</code></h3>
Tráº£ vá» <code>True</code> náº¿u áº£nh cÃ³ trÃªn mÃ n hÃ¬nh. DÃ¹ng trong khá»‘i <code>if</code>.
- <b>region:</b> <code>[x, y, w, h]</code> Ä‘á»ƒ giá»›i háº¡n vÃ¹ng tÃ¬m kiáº¿m (TÄƒng tá»‘c Ä‘á»™).

<h3><code>while_image(asset_id)</code></h3>
Láº·p láº¡i khá»‘i lá»‡nh MIá»„N LÃ€ áº£nh cÃ²n trÃªn mÃ n hÃ¬nh.
- <b>Ex:</b> <code>while_image("enemy"): attack()</code>

<h3><code>if_pixel(x, y, color)</code></h3>
Giá»‘ng <code>if_image</code> nhÆ°ng kiá»ƒm tra mÃ u cá»§a 1 pixel.

<h3><code>read_text(variable, region)</code></h3>
Äá»c vÄƒn báº£n tá»« mÃ n hÃ¬nh (OCR) vÃ  lÆ°u vÃ o biáº¿n.
- <b>variable:</b> TÃªn biáº¿n (vd: <code>"$hp"</code>).
- <b>region:</b> VÃ¹ng cáº§n Ä‘á»c <code>[x, y, w, h]</code>.
- <b>Ex:</b> <code>read_text("$gold", [10, 10, 100, 20])</code>

---

<h2>7.3 âŒ¨ï¸ Keyboard & Input (BÃ n phÃ­m)</h2>

<h3><code>type_text(text, interval=0, enter=False)</code></h3>
GÃµ vÄƒn báº£n nhÆ° ngÆ°á»i dÃ¹ng.
- <b>interval:</b> Äá»™ trá»… giá»¯a cÃ¡c phÃ­m (ms).
- <b>enter:</b> Nháº¥n Enter cuá»‘i cÃ¹ng.

<h3><code>hotkey(sequence)</code></h3>
Gá»­i tá»• há»£p phÃ­m.
- <b>Ex:</b> <code>"Ctrl+C"</code>, <code>"Alt+F4"</code>, <code>"Win+R"</code>.

---

<h2>7.4 â±ï¸ Timing & Delays (Thá»i gian)</h2>

<h3><code>delay(amount, random=False)</code> / <code>sleep()</code></h3>
Dá»«ng script.
- <b>amount:</b> <code>1s</code>, <code>500ms</code>.

<h3><code>delay_random(min_ms, max_ms)</code></h3>
Dá»«ng ngáº«u nhiÃªn (Quan trá»ng cho Anti-ban).

---

<h2>7.5 ğŸ”„ Flow Control (Äiá»u khiá»ƒn luá»“ng)</h2>

<h3><code>if</code>, <code>elif</code>, <code>else</code>, <code>endif</code></h3>
Cáº¥u trÃºc ráº½ nhÃ¡nh Ä‘iá»u kiá»‡n.
<code></code>`retroscript
if_image("A"):
    click("A")
else:
    click("B")
<code></code>`

<h3><code>loop n</code> / <code>endloop</code></h3>
Láº·p sá»‘ láº§n cá»‘ Ä‘á»‹nh. <code>loop 0</code> hoáº·c khÃ´ng tham sá»‘ = Láº·p vÃ´ háº¡n.

<h3><code>run_flow(name)</code></h3>
Gá»i má»™t Flow khÃ¡c (Sub-routine).

<h3><code>goto(label)</code> / <code>label(name)</code></h3>
Nháº£y Ä‘áº¿n vá»‹ trÃ­ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u.

<h3><code>if_text(variable, operator, value)</code></h3>
So sÃ¡nh giÃ¡ trá»‹ vÄƒn báº£n/sá»‘.
- <b>operator:</b> <code>"=="</code>, <code>"!="</code>, <code>">"</code>, <code>"<"</code>, <code>"contains"</code>.
- <b>Ex:</b> <code>if_text("$hp", "<", 50)</code>

---

<h2>7.6 ğŸ“¡ Remote & Notify</h2>

<h3><code>notify(message, method="popup")</code></h3>
Gá»­i thÃ´ng bÃ¡o.
- <b>method:</b> <code>"popup"</code> (Máº·c Ä‘á»‹nh), <code>"telegram"</code>, <code>"discord"</code>, <code>"sound"</code>.

---

<h2>ğŸ§± Cáº¥u trÃºc DSL (Internal)</h2>

<h3>Data Types</h3>
- <b>Integer:</b> <code>123</code>
- <b>Float:</b> <code>12.5</code>
- <b>String:</b> <code>"Hello"</code> (Trong ngoáº·c kÃ©p)
- <b>Duration:</b> <code>10s</code>, <code>500ms</code>
- <b>Boolean:</b> <code>true</code>, <code>false</code>

<h3>Operators</h3>
- Arithmetic: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>
- Comparison: <code>==</code>, <code>!=</code>, <code><</code>, <code>></code>
- Logic: <code>and</code>, <code>or</code>, <code>not</code>

> ğŸ’¡ <b>Pro Tip:</b> Báº¡n cÃ³ thá»ƒ dÃ¹ng biá»ƒu thá»©c toÃ¡n há»c trong tham sá»‘:
> <code>click(x + 10, y * 2)</code>

---

<h2>ğŸ”¬ Under the Hood (CÆ¡ Cháº¿ BÃªn Trong)</h2>

<h3>1. Biáº¿n & Pháº¡m Vi (Variable Scope)</h3>

RetroAuto sá»­ dá»¥ng <b>Global Scope</b> duy nháº¥t cho toÃ n bá»™ script.

<code></code>`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GLOBAL SCOPE                     â”‚
â”‚                                                  â”‚
â”‚  $hp = 100                                       â”‚
â”‚  $gold = 5000                                    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ @main:         â”‚   â”‚ @heal:         â”‚         â”‚
â”‚  â”‚   $hp = 50     â”‚â”€â”€â–¶â”‚   if $hp < 30  â”‚ âœ… OK   â”‚
â”‚  â”‚   run_flow()   â”‚   â”‚     ...        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<code></code>`
<b>Káº¿t luáº­n:</b>
- Biáº¿n <code>$hp</code> khai bÃ¡o á»Ÿ <code>@main</code> <b>cÃ³ thá»ƒ Ä‘á»c/ghi</b> tá»« <code>@heal</code>.
- <b>KhÃ´ng cÃ³ Local Scope riÃªng biá»‡t</b> cho má»—i Flow.
- <b>Gotcha:</b> TÃªn biáº¿n dá»… bá»‹ ghi Ä‘Ã¨ náº¿u trÃ¹ng. HÃ£y Ä‘áº·t tÃªn rÃµ rÃ ng (<code>$main_hp</code> thay vÃ¬ <code>$hp</code>).

<h3>2. Call Stack & Äá»‡ Quy</h3>

Khi gá»i <code>run_flow("A")</code>, há»‡ thá»‘ng <b>push</b> má»™t Frame vÃ o Stack:

<code></code>`
Stack: [Main] -> [A] -> [B] -> [C] ...
<code></code>`
<b>Giá»›i háº¡n:</b> Stack tá»‘i Ä‘a <b>100 levels</b> (Configurable).
<b>Gotcha:</b> Náº¿u Flow A gá»i láº¡i chÃ­nh nÃ³ (Ä‘á»‡ quy vÃ´ háº¡n), sáº½ gáº·p <code>RecursionError</code>.

<h3>3. Hiá»‡u NÄƒng Vision (Performance)</h3>

| TÃ¡c vá»¥ | Thá»i gian Æ°á»›c tÃ­nh | Ghi chÃº |
|--------|-------------------:|---------|
| <code>if_image</code> (Full Screen 1080p) | 50-150 ms | Cháº­m, trÃ¡nh dÃ¹ng trong vÃ²ng láº·p nhanh. |
| <code>if_image</code> (ROI 100x100 px) | 2-10 ms | <b>Nhanh gáº¥p 10x.</b> |
| <code>wait_pixel</code> | < 1 ms | Cá»±c nhanh, chá»‰ kiá»ƒm tra 1 Ä‘iá»ƒm. |
| OCR <code>read_text</code> | 100-500 ms | Náº·ng, dÃ¹ng tiáº¿t kiá»‡m. |

<b>Best Practice:</b> LuÃ´n dÃ¹ng <code>region=[x, y, w, h]</code> Ä‘á»ƒ giá»›i háº¡n vÃ¹ng tÃ¬m kiáº¿m.
</section>

</body>
</html>
