# Part 4: Core Concepts (NguyÃªn LÃ½ Cá»‘t LÃµi) ğŸ§ 

---

## 4.1 Execution Model (CÆ¡ cháº¿ Hoáº¡t Ä‘á»™ng)

RetroAuto sá»­ dá»¥ng **Event Loop Hybrid**: Káº¿t há»£p giá»¯a tuáº§n tá»± (Main Thread) vÃ  song song (Interrupt Watchdog).

### ğŸ“ The Runtime Loop ASCII Art

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN THREAD (Synchronous) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   [Start]                                                   â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Fetch Instruction] <â”€â”€â”€(Step Pointer)                    â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Execute Action] (Click, Type, Wait...)                   â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”‚  âš ï¸ BLOCKED? (e.g. sleep 5s)                         â”‚
â”‚      â”‚  (Main thread sleeps, but Background thread is ALIVE)â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Check Events] (Stop? Pause?)                             â”‚
â”‚      â”‚                                                      â”‚
â”‚      â””â”€â”€â”€â–º Loop to Next Instruction                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–²                 â”‚
               â”‚ (Pause Request) â”‚ (Resume)
               â”‚                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACKGROUND THREAD (Asynchronous) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   [Sentinel Timer (500ms)]                                  â”‚
â”‚      â”‚                                                      â”‚
â”‚      â–¼                                                      â”‚
â”‚   [Scan All Interrupt Rules]                                â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€â–º Rule 1: Login Screen? (No)                        â”‚
â”‚      â”‚                                                      â”‚
â”‚      â”œâ”€â”€â–º Rule 2: Low HP? (YES!) â”€â”€â”                        â”‚
â”‚      â”‚                             â”‚                        â”‚
â”‚      â””â”€â”€â–º Rule 3: Error Popup?     â”‚                        â”‚
â”‚                                    â”‚                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚          â–¼                                                  â”‚
â”‚   [PREEMPTION TRIGGERED]                                    â”‚
â”‚   1. Pause Main Thread                                      â”‚
â”‚   2. Save Context (Stack/Variables)                         â”‚
â”‚   3. Run "HealFlow"                                         â”‚
â”‚   4. Resume Main Thread                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4.2 Priority System (Há»‡ thá»‘ng Æ¯u tiÃªn)

Khi nhiá»u sá»± kiá»‡n xáº£y ra cÃ¹ng lÃºc, ai tháº¯ng?

```
High Priority (P10) > Medium (P5) > Low (P1)
```

**VÃ­ dá»¥ xung Ä‘á»™t:**
- **Sá»± kiá»‡n A:** Háº¿t mÃ¡u (P10, Flow: "Heal")
- **Sá»± kiá»‡n B:** TÃºi Ä‘áº§y (P5, Flow: "SellItems")

**Ká»‹ch báº£n:**
1. Bot tháº¥y cáº£ "Háº¿t mÃ¡u" vÃ  "TÃºi Ä‘áº§y".
2. **P10 (Heal)** chiáº¿n tháº¯ng -> Cháº¡y `Heal` trÆ°á»›c.
3. Sau khi `Heal` xong, náº¿u váº«n tháº¥y "TÃºi Ä‘áº§y", cháº¡y `SellItems`.

---

## 4.3 Coordinate Systems (Há»‡ Tá»a Äá»™)

CÃ¡ch RetroAuto Ä‘á»‹nh vá»‹ trÃªn mÃ n hÃ¬nh:

```
(0,0) Top-Left
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€X (Width)
  â”‚
  â”‚      [Global Coordinate]
  â”‚      Click(500, 300)
  â”‚          Target
  â”‚            â–¼
  â”‚            âœ•
  â”‚
  â”‚
  Y
(Height)
```

**ROI (Region of Interest - VÃ¹ng quan tÃ¢m):**
Thay vÃ¬ tÃ¬m trÃªn cáº£ mÃ n hÃ¬nh, chá»‰ tÃ¬m trong má»™t há»™p nhá».

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Screen (1920x1080)                               â”‚
â”‚                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ ROI (Health Bar) â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ [##########........] 50%        â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
**Lá»£i Ã­ch:** TÄƒng tá»‘c Ä‘á»™ tÃ¬m kiáº¿m gáº¥p 5-10 láº§n.
